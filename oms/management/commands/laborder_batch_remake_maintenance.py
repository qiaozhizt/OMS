# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from django.db import connections
from django.db import transaction

from django.core.management.base import BaseCommand
from oms.views import *
from oms.const import *
import logging
import datetime
from django.db.models import Q

from django.http import HttpRequest
from oms.controllers.order_controller import *


class Command(BaseCommand):
    def handle(self, *args, **options):
        logging.critical('start remake lab orders ....')

        lbos_numbers = """91026-159212-2T2
        91027-159315-2T2
        91025-159011-1T1
        91026-159154-1T2-1
        91026-159117-2T2
        91026-159152-2T2
        91025-158876-1T1
        91026-159064-2T2
        91026-159124-2T2
        91026-159079-1T1
        91025-158918-1T1
        91025-158772-1T1
        91026-159120-2T2
        90919-150037-1T1-R2
        91025-158921-1T1
        91025-159000-1T1
        91025-158926-1T1
        91025-158990-1T1
        91025-158793-1T1
        91025-159032-2T2
        91025-158958-1T1
        91025-158986-2T2
        91025-158708-2T2
        91025-158695-2T2
        91026-159036-2T2
        91025-158957-1T2-1
        91024-158590-1T1
        91025-158932-1T1
        91026-159055-2T2
        91025-158717-1T1
        91025-158910-1T1
        91026-159066-2T2
        91025-158702-1T1
        91026-159045-2T2
        91025-158835-1T1
        91025-158696-1T1
        91025-158861-2T2
        91024-158556-1T1
        91024-158551-1T1
        91025-159016-2T2
        91025-158846-2T2
        91025-158831-4T4
        91025-158868-2T2
        91025-158967-3T3
        91026-159088-3T3
        91025-158746-1T1
        91024-158575-1T1
        91027-159314-1T1
        91027-159321-1T1
        91024-158515-1T1
        91025-158799-1T1
        91027-159444-1T1
        91025-158822-1T1
        91027-159297-1T1
        91025-158872-1T1
        91025-158867-1T1
        91027-159372-1T1
        91026-159090-1T1
        91025-158817-1T1
        91026-159133-1T1
        91025-158945-1T1
        91026-159126-1T1
        91027-159478-1T1
        91026-159255-1T1
        91027-159289-1T1
        91025-159030-1T1
        91025-158816-1T1
        91027-159466-2T2
        91027-159393-2T2
        91026-159134-2T2
        91027-159407-2T2
        91026-159111-2T2
        91024-158576-1T1
        91025-158792-2T2
        91024-158659-1T1
        91026-159147-2T2
        91025-158753-1T1
        91027-159482-2T2
        91024-158570-1T1
        91024-158562-1T1
        91024-158559-1T1
        91025-158880-1T1
        91025-158747-3T3
        91026-159145-2T2
        91025-158903-1T1
        91026-159034-2T2
        91025-158966-1T1
        91025-158894-1T1
        91025-158961-1T1
        91027-159439-3T3
        91025-158873-1T1
        91026-159060-3T3
        91025-158916-3T3
        91027-159455-3T3
        91027-159345-3T3
        91027-159367-1T1
        91010-155004-1T1-R1
        91025-158801-1T1
        91026-159201-1T1
        91026-159164-2T2
        91026-159112-4T4
        91025-158834-1T1
        91024-158588-1T1
        91025-159008-1T1
        91026-159084-4T4
        91024-158541-1T1
        90902-146104-1T1-R1
        91026-159222-2T2
        91025-158720-2T2
        91025-158917-1T1
        91025-159002-1T1
        91026-159263-2T2
        91024-158536-1T1
        91026-159230-2T2
        91025-158780-1T1
        91025-158906-1T2-1
        91026-159271-2T2
        91027-159429-2T2
        91026-159252-2T2
        91025-158936-2T2
        91026-159190-2T2
        91027-159472-2T2
        91024-158661-1T1
        91025-159021-1T1
        91026-159272-1T1
        91025-158729-1T1
        91026-159227-1T1
        91024-158553-1T1
        91027-159361-1T1
        91027-159340-1T1
        91026-159142-1T1
        91026-159264-1T1
        91025-158844-1T1
        91025-158935-1T1
        91026-159065-1T1
        91011-155159-1T1-R1
        91027-159362-1T1
        91026-159132-1T1
        91026-159277-1T1
        91025-158790-1T1
        91025-158800-1T1
        91025-158767-1T1
        91025-158928-1T1
        91025-158964-1T1
        91027-159334-1T1
        91025-158897-1T1
        91024-158484-1T1
        91025-158962-1T1
        91025-159005-1T1
        91025-158809-1T1
        91027-159282-1T1
        90914-149034-1T1-R1
        91025-158914-1T1
        91026-159087-1T1
        91026-159274-1T1
        91025-159025-1T1
        91024-158671-1T1
        91026-159053-1T1
        91025-158883-1T1
        91026-159113-1T1
        91025-158877-1T1
        91025-158965-1T1
        91027-159285-1T1
        91026-159177-1T1
        91026-159137-1T1
        91017-156980-1T1-R1
        91027-159452-1T1
        91026-159265-1T1
        91027-159313-1T1
        91025-158820-1T1
        91027-159366-1T1
        91027-159363-1T1
        91027-159369-1T1
        91025-159003-1T1
        91027-159335-1T1
        91024-158477-1T1
        91025-158754-1T1
        91025-158699-6T6
        91025-158849-1T1
        91026-159063-1T1
        91024-158647-2T2
        91026-159050-1T1
        91025-158836-1T1
        91025-158892-1T1
        91024-158450-1T1
        91025-158779-1T1
        91025-158902-1T1
        91025-158942-1T1
        91025-158761-1T1
        91025-158764-1T1
        91025-158756-1T1
        91024-158638-1T1
        91025-158886-1T1
        91025-158969-1T1
        91024-158542-1T1
        91024-158634-1T1
        91025-158794-1T1
        91026-159225-1T1
        91025-158950-1T1
        91024-158663-1T1
        91008-154569-1T2-R1
        91025-158819-1T1
        91026-159250-1T1
        91025-158818-1T1
        91025-158953-1T1
        91026-159234-5T5
        91024-158651-3T3
        91025-158947-2T2
        91025-158718-2T2
        91026-159097-1T1
        91025-158864-2T2
        91025-158833-1T1
        91025-158995-2T2
        91025-158885-1T1
        91026-159110-1T1
        91026-159194-1T1
        91025-158845-1T1
        91026-159202-1T1
        91025-158745-1T1
        91025-158955-1T1
        91025-158998-1T1
        91025-158760-1T1
        91025-158803-1T1
        91025-158778-1T1
        91024-158455-1T1
        91026-159083-1T1
        91024-158642-1T1
        91025-158941-1T1
        91026-159148-1T1
        91026-159035-1T1
        91025-159018-1T1
        91026-159248-1T1
        91025-158920-1T1
        91025-158929-1T1
        91026-159078-1T1
        91025-158895-1T1
        91026-159175-1T1
        91024-158460-1T1
        91026-159195-1T1
        91025-159014-1T1
        91025-158888-1T1
        91025-158751-1T1
        91026-159228-1T1
        91025-158829-1T1
        91026-159246-1T1
        91025-158785-1T1
        91024-158664-1T1
        91026-159229-1T1
        91026-159156-1T1
        91026-159160-1T1
        91025-158893-1T1
        91025-158900-1T1"""

        lbos_numbers = lbos_numbers.split(' ')
        items = []
        for lbo_number in lbos_numbers:
            logging.critical("lab_number: %s" % lbo_number)
            if lbo_number != '':
                if not 'R' in lbo_number:
                    items.append(lbo_number)

        logging.critical(len(lbos_numbers))
        logging.critical(len(items))

        for item in items:
            logging.critical("available lab_number: %s" % item)

        for item in items:
            logging.critical("available lab_number: %s" % item)

            new_lab_number = "%s%s" % (item.strip(), "-R1")
            logging.critical("new lab_number: %s" % new_lab_number)

            logging.critical("looking for laborder: %s" % item.strip())
            lbo = LabOrder.objects.get(lab_number=item.strip())

            try:
                lbo_new = LabOrder.objects.get(lab_number=new_lab_number)
                logging.critical("remake order duplicate ....")
                continue
            except Exception as ex:
                logging.critical('create remake order when exception.')
                lbo_new = LabOrder()
                origin_valus=lbo.__dict__
                origin_valus.pop('id')
                lbo_new.__dict__.update(**origin_valus)
                lbo_new.lab_number = new_lab_number
                lbo_new.status = None
                lbo_new.save()

        logging.critical(len(items))
        logging.critical('remake lab orders completed ....')
