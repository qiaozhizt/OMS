{% extends 'base.html' %}
{% load static %}
{% block style %}
    <link rel="stylesheet" type="text/css" href="/static/layui/css/layui.css" />
    <style>
        .span_title{
            padding-right: 30px;
        }
        .stack_a{
            cursor: pointer;
            color: #ffffff;
        }
        /* 防止下拉框的下拉列表被隐藏---必须设置--- */
        .layui-table-cell {overflow: visible !important;        }
        /* 使得下拉框与单元格刚好合适 */
        td .layui-form-select{
            margin-top: -10px;
            margin-left: -15px;
            margin-right: -15px;
        }
        .input-top{
            margin-top: 15px;
        }
    </style>
{% endblock %}
{% block h1 %}成镜订单管理{% if form_data.total %}<span class="label label-info">{{ form_data.total }}</span>
{% endif %} {% endblock %}
{% block small %}成镜库存状态查询{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-xs-12">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box-body form-inline box">
                        <div class="form-group">
                            <input type="text" name="frame_sku" class="form-control" id="frame_sku"
                                   value=""
                                   placeholder="Frame SKU"
                                   style="width:120px;"/>
                        </div>
                        <div class="form-group" id="filters">
                            <div class="layui-form">
                                 <select style="width: 300px; height: 35px; line-height: 35px;" id="warehouse">
                                    <option value="">请选择Warehouse</option>
                                    {% for item in whs %}
                                        <option value="{{ item.code }}">{{ item.name }}</option>
                                    {% endfor %}
                                 </select>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" id="search_btn" style="margin-left: 5px;" lay-event="save">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="box box-default">
                <div class="box-header">
                    <h3 class="box-title">Stock In Request List：</h3>
                </div>
                <table class="layui-hide" id="stock_in_table" lay-filter="demo" style="overflow-x: hidden;"></table>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
    </div>
{% endblock %}
{% block jquery %}
    <script type="text/javascript" src="/static/layui/layui.js"></script>
    <script>
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
        });
        laydate.render({
          elem: '#start_date'
          ,type: 'datetime' //默认，可不填
        });
        layui.use(['table', 'layer', 'element', 'jquery', 'form'], function() {
            var table = layui.table;
            var form = layui.form;
            //第一个实例
            table.render({
                elem: '#stock_in_table'
                ,toolbar: '#toolbarDemo'
                , height: 'full-10'
                , url: "{% url 'stock_struct_list_data' %}"
                , where: {flag:'list'}
                ,done: function(res, curr, count){
                   // 渲染dictName列
                    laydate.render({
                      elem: '#start_date'
                      ,type: 'datetime' //默认，可不填
                    });
                    //得到当前页码
                    console.log(curr);
                    //得到数据总量
                    console.log(count);
                }
                , cellMinWidth: 100
                , page: true //开启分页
                , limit:30
                , limits:[30,50,70,90,120,10000]
                , even: true
                , cols: [[ //表头
                    {field: 'id', title: 'ID', sort: true}
                    , {field: 'frame', title: '成镜 SKU'}
                    //, {field: 'lens_sku', title: 'Lens SKU'}
                    , {field: 'quantity', title: 'Quantity', sort:true}
                    , {field: 'warehouse', title: 'Warehouse'}
                    //, {field: 'location', title: 'Location', width:120}
                    //, {field: 'comments', title: 'Comments'}
                ]]
            });
            $("#search_btn").click(function () {
                var frame = $("#frame_sku").val();
                var warehouse = $("#warehouse").val();
                table.reload('stock_in_table',{
                    url: "{% url 'stock_struct_list_data' %}",
                    where: {
                        frame:frame,
                        warehouse:warehouse,
                    },
                    page:{
                        curr:1
                    }
                })
            });
            table.on('toolbar(demo)', function (obj) {
             var layEvent = obj.event;
             if (layEvent == 'search'){
                var frame = $("#lab_number").val();
                var warehous = $("#warehous").val();
                table.reload('stock_in_table',{
                    url: "{% url 'stock_struct_list_data' %}",
                    where: {
                        frame:frame,
                        warehous:warehous
                    },
                    page:{
                        curr:1
                    }
                })
             }
            });
        });
    </script>
{% endblock %}
